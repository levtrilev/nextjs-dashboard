## Нафиг ERP!

<details>
<summary>ERP - это тяжело. Это надо объяснять?</summary>

ERP это дорого, долго, нудно, некрасиво. Даже когда ERP уже развернута — люди с трудом и главное с неохотой ее осваивают.  
Поддержка — дорого! Каждому сотруднику и айтишнику надо доплачивать за то, что он ERP-специалист.  
SAP? — Боже упаси! (а теперь еще и санкции)  
1С — Боже упаси! (а теперь еще и подороже SAP будет).  
Прогаммисты нос воротят — только за хорошие деньги! Серверов не напасешься. Потратишься и все равно одна головная боль. Не дай Бог, если нужно развернуть на тысячи пользователей. Заплатишь в три конца за лицензии, за железо, а основная масса пользователей пользуется одной формочкой.  
Вспоминаем анекдот: Не доллары? А что?!!!

</details>

<details>
<summary>Не 1С? А что?!!!</summary>

А самописные системы!

Нафиг все платные и закрытые системы и платформы! Берем самый современный "модный-молодежный" стэк технологий.  
Чтобы джуны в очереди стояли — только дай поработать для портфолио. И чтобы глобальная поддержка Open-source-сообщества.  
Чтобы AI уже прокачан на Stack Overflow.

- **Frontend?** Нафиг выбирать между Windows/Linux/Mobile! React + Next.js + Tailwind CSS! (заодно нафиг Redux и MobX! — Zustand!).
- **Backend?** Нафиг вообще Backend! React Server Components! Всё в единой кодовой базе, силами одного fullstack-разработчика.
- **СУБД?** Нафиг Oracle и MS SQL! Только Postgres.

</details>

<details>
<summary>С чего начнем? — с разграничения прав доступа</summary>

Систему сразу будем делать **multitenant** — для предоставления нескольким независимым организациям.  
Так и назовем их **"tenants"** (таблица БД).

- Внутри каждой организации будут свои пользователи (**таблица "users"**) — у другой организации уже есть такой логин? Не проблема!
- И свой админ или несколько админов. Запись в таблице `"users"` имеет поле `"tenant_id"`.
- Пользователи-админы имеют признак `"admin"=true`.
- На уровне всей системы управляет **суперадмин**. Пользователи-суперадмины имеют признак `"superadmin"=true`.

Все пространство для документов системы разделено на **разделы** (**таблица "sections"**).  
Разделы принадлежат только одной организации (запись в `"sections"` имеет поле `"tenant_id"`).  
Каждый документ в системе будет помещён в тот или иной раздел (запись документа имеет поле `"section_id"`).

Права на типы документов (такие как счета, договоры) будем предоставлять не пользователям, а **ролям** (**таблица "roles"**). Каждая роль имеет область действия только внутри своей организации (имеет поле `"tenant_id"`).  
Поэтому в неё могут быть включены только пользователи своего предприятия (имеют поле `"tenant_id"`, совпадающее с `"tenant_id"` роли).

Пользователи имеют права как сумму прав ролей, в которые они включены.  
Права роли включают:
- права на доступ к разделам (несколько разделов),
- права на типы документов (**таблица "permissions"**, запись = пара `"role_id"` и `"doctype_id"` + описание прав доступа).

</details>

<details>
<summary>Описание прав доступа: permissions</summary>

- **Полный доступ**  
  Читает все записи.  
  Физически: создает / изменяет / удаляет.  
  Логически: делегирует, утверждает, отзывает статус утверждения, удаляет, восстанавливает удалённые.

- **Читатель**  
  Читает (только утверждённые!) документы всех Авторов, без возможности отзыва / редактирования / удаления / восстановления.

- **Автор**  
  Читает (только свои!) `draft` / `active` / `deleted` документы.  
  Создаёт `draft` / изменяет `draft` / утверждает `draft` / отзывает `active` / удаляет `draft` / восстанавливает `deleted` (только свои!) документы.  
  Если Автор не является Читателем — он не видит документы других Авторов.

- **Редактор**  
  Имеет права Автора над документами других Авторов и сам является Автором своих документов.  
  После изменения "чужого" документа не становится Автором — его имя (`user_id`) остаётся в поле `"editor"`.  
  Имеет право делегировать авторство другому пользователлю, в том числе себе.

- **Право удаления**  
  Без влияния на чтение. Имеет право физического удаления только логически-удалённых документов,  
  тех, которые имеет право видеть:  
  - Автор — свои,  
  - Редактор — все,  
  - Читателю нечего удалять — он не видит логически удалённые.

- **Доступ по тэгам**  
  При указанном признаке `tags-access` доступ осуществляется при наличии в документе указанных тэгов — поле `"tags"` (тип `JSONB`).  
  В полномочиях отдельно указываются тэги, учитывающиеся по **«И»**, по **«ИЛИ»** и по **«НЕ»**.

  Примеры:
  - Доступ по ИЛИ-тэгам:  
    ```sql
    SELECT * FROM records WHERE tags ? 'internal' OR tags ? 'спб'
    ```
  - Доступ по НЕ-тэгам:  
    ```sql
    SELECT * FROM records WHERE NOT (tags ? 'confidential')
    ```

</details>